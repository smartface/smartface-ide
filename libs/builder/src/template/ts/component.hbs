{{> header}}
import { Styleable } from '{{coreLibPath}}/Styleable';
import View = require('@smartface/native/ui/view');
import { ComponentStyleContext } from '@smartface/styling-context/lib/ComponentStyleContext';
import { extendOfViewGroup } from "@smartface/styling-context/lib/extendOfViewGroup";
import { styleableComponentMixin, styleableContainerComponentMixin } from "@smartface/styling-context/lib/styleableComponentMixin";
import System = require('@smartface/native/device/system');

{{require this footer "true"}} {{getRequiredIrregularEnums smfObjects}}
{{getRequiredLibModules smfObjects "true"}}

interface {{capitalizeFirstLetter libraryType}}Children {
    {{#each smfObjects}} {{name}}?: {{varName}}; {{/each}}
    [key: string]: any;
};

	export default class {{capitalizeFirstLetter libraryType}} extends {{#if isContainerComponent}} 
  styleableContainerComponentMixin({{type}}) {{else}}
   styleableComponentMixin({{type}}) {{/if}} {
    {{#isEqual type "ShimmerFlexLayout"}}
        layout: FlexLayout;
    {{/isEqual}}
    {{!-- TODO: only container components --}}
    protected _children: {{capitalizeFirstLetter libraryType}}Children = {};
    get children(): Readonly<{{capitalizeFirstLetter libraryType}}Children> {
        return this._children;
    }
    {{!-- {{#if smfObjects}}{{#isRepeatedView type}} {{else}}children: { [key: string]: any } = {};{{/isRepeatedView}}{{/if}} --}}
    static $$styleContext: ComponentStyleContext = { 
	classNames: {{json className}},
	defaultClassNames: {{json defaultClassNames}},
	userProps: {{#isEmpty props}} {} {{else}}{{> eachHelper props=props}}{{/isEmpty}} };
    {{#isRepeatedView type}}
        private itemIndex = 0;
	{{/isRepeatedView}}
    {{#each componentsAssignedToRoot}}{{name}}: {{klass}};{{/each}}
    constructor(props?: any) {
    super(
    {{#if layoutManager }} { {{> gridViewBody layoutManager=./layoutManager }} {{#isEmpty attributes}}{{else}},...{{> eachHelper props=attributes isAttribute=true rawProps=./rawProps}}{{/isEmpty}}    } {{else}}
	{{#isEmpty attributes}}props{{else}}{{> eachHelper props=attributes isAttribute=true rawProps=./rawProps}}{{/isEmpty}} {{/if}});
    {{#isRepeatedView type}} {{else}}
        {{#isEqual type "ShimmerFlexLayout"}}
            {{#if children.0.constructorName}}this.contentLayout = new {{children.0.constructorName}}(); this.layout = this.contentLayout; this.children['contentLayout'] = this.layout;{{else}}this.contentLayout = ( this.layout || new FlexLayout({flexGrow: 1})); this.layout = this.contentLayout; {{/if}} {{else}}
                {{#each children}}this.addChildByName(new {{constructorName}}(), {{json name}});{{/each}}
                {{#each componentsAssignedToRoot}}this.{{name}} = {{ref}};{{/each}}
        {{/isEqual}}
    {{/isRepeatedView}}
    {{#if html}} 
    const html =  {{getString "html" html ""}};
    const attributedStrings = createAttributedStrings(html);
    this.attributedText = attributedStrings.map( s => new AttributedString(propFactory.default(s)));
    {{/if}}
    {{#isRepeatedView type}}
		{{#if isLibraryComponent}}{{else}}{{#if isModuleComp}}{{else}}{{> onRowCreate children=./smfObjects defaultItemType=./defaultItemType}}{{/if}}{{/if}}{{else}}
	{{/isRepeatedView}}
    {{#if isLibraryPage}}this.testId = {{json testId}}; {{/if}}
    }
    {{#if smfObjects}}{{#isRepeatedView type}} {{else}} addChildByName(child: View<any>, name: string) {
        this._children[name] = child;
        this.addStyleableChild(child, name);
        this.addChild(child);
    }
    {{!-- TODO: Use only container components --}}
    {{!-- Context's addchild method definition --}}
    addChild(child: View<any>, name?: string, classNames?: string, userProps?: { [key: string]: any; }, defaultClassNames?: string): void {
        if (this['layout']) {
            this['layout'].addChild(child);
        } else {
            super.addChild(child);
        }
    }
    {{/isRepeatedView}}{{/if}}{{#if ifNeededApplyingTestId}}
    applyTestIDs(testId: string){
        Object.keys(this._children).forEach( child => {
            this._children[child].testId = testId + '_' + child.charAt(0).toUpperCase() + child.slice(1);
            if(this._children[child].applyTestIDs){
                this._children[child].applyTestIDs(this._children[child].testId);
            }
        });
    }{{/if}}
}

{{> body}}